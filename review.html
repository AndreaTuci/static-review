
<!DOCTYPE html>
<html lang="it">
<head>
    <base href="./">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lettore Rassegna Stampa</title>
    <meta name="csrf-token" content="LVAOsmMsqctNN7fl2XBzu6GkWiwOEp5OEedqucXxHsZ51IEjvoqdBBDfMAKLwBrl">
    <input type="hidden" name="csrfmiddlewaretoken" value="LVAOsmMsqctNN7fl2XBzu6GkWiwOEp5OEedqucXxHsZ51IEjvoqdBBDfMAKLwBrl">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .review-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            line-height: 1.6;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .btn.danger {
            background: #e74c3c;
        }
        
        .btn.danger:hover {
            background: #c0392b;
        }
        
        .btn.success {
            background: #27ae60;
        }
        
        .btn.success:hover {
            background: #229954;
        }
        
        .control-group {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-group label {
            min-width: 100px;
            font-weight: bold;
        }
        
        .control-group input[type="range"] {
            flex: 1;
            margin: 0 10px;
        }
        
        .control-group span {
            min-width: 60px;
            text-align: center;
            font-weight: bold;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .status.info {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .voice-selector {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.3s;
        }
        
        .reading-text {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        /* Stili Calendario */
        .calendar {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .calendar-header {
            background: #34495e;
            color: white;
            padding: 15px 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        
        .calendar-day-header {
            background: #ecf0f1;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            color: #7f8c8d;
            border-bottom: 1px solid #bdc3c7;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 1px solid #ecf0f1;
            background: white;
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: #2c3e50;
        }
        
        .calendar-day:hover {
            background: #f8f9fa;
            transform: scale(1.05);
        }
        
        .calendar-day.empty {
            background: #f8f9fa;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            transform: none;
            background: #f8f9fa;
        }
        
        .calendar-day.today {
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.today:hover {
            background: #2980b9;
        }
        
        .calendar-day.has-review {
            background: #27ae60;
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.has-review:hover {
            background: #229954;
        }
        
        .calendar-day.has-review.today {
            background: #e74c3c;
            color: white;
        }
        
        .calendar-day.has-review.today:hover {
            background: #c0392b;
        }
        
        .calendar-day.future {
            color: #bdc3c7;
            background: #f8f9fa;
        }
        
        .calendar-day.future:hover {
            background: #f8f9fa;
            transform: none;
            cursor: default;
        }
        
        .review-indicator {
            position: absolute;
            top: 3px;
            right: 3px;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            border: 1px solid white;
        }
        
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 15px;
            background: #f8f9fa;
            font-size: 12px;
        }
            /* Classe per nascondere il calendario */
            .hide {
                display: none !important;
            }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        /* Stili Rating System */
        .rating-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .rating-stars .star {
            font-size: 24px !important;
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s !important;
            margin: 0 2px;
            transform: none !important;
        }
        
        .rating-stars .star:hover {
            color: #f39c12 !important;
            transform: none !important;
            font-size: 24px !important;
        }
        
        /* Regola più specifica per forzare la dimensione */
        .rating-section .rating-stars .star,
        .rating-section .rating-stars .star:hover,
        .rating-section .rating-stars .star:active,
        .rating-section .rating-stars .star:focus {
            transform: none !important;
            scale: 1 !important;
            font-size: 24px !important;
        }
        
        .rating-stars .star.active {
            color: #f39c12;
        }
        
        .current-rating {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .current-rating .stars {
            margin-right: 10px;
        }
        
        .rating-display {
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🎤 Lettore Rassegna Stampa</h1>
        <p>Sintesi vocale tramite browser - Qualità superiore</p>
    </div>
    
    <!-- Calendario -->
    <div class="calendar">
        <div class="calendar-header">
            📅 October 2025
        </div>
        <div class="calendar-grid">
            <!-- Intestazioni giorni -->
            <div class="calendar-day-header">LUN</div>
            <div class="calendar-day-header">MAR</div>
            <div class="calendar-day-header">MER</div>
            <div class="calendar-day-header">GIO</div>
            <div class="calendar-day-header">VEN</div>
            <div class="calendar-day-header">SAB</div>
            <div class="calendar-day-header">DOM</div>
            
            <!-- Giorni del mese -->
            
                
                    
                        <div class="calendar-day empty"></div>
                    
                
                    
                        <div class="calendar-day empty"></div>
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                1
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                2
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                3
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                4
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                5
                            </div>
                        
                    
                
            
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                6
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                7
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                8
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                9
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                10
                            </div>
                        
                    
                
                    
                        
                            <a href="/tts/reader/43/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 11 Ottobre 2025">
                                11
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/83/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 12 Ottobre 2025">
                                12
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
            
                
                    
                        
                            <a href="/tts/reader/84/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 13 Ottobre 2025">
                                13
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                14
                            </div>
                        
                    
                
                    
                        
                            <a href="/tts/reader/85/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 15 Ottobre 2025">
                                15
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/86/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 16 Ottobre 2025">
                                16
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/88/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 17 Ottobre 2025">
                                17
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/89/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 18 Ottobre 2025">
                                18
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                19
                            </div>
                        
                    
                
            
                
                    
                        
                            <a href="/tts/reader/90/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 20 Ottobre 2025">
                                20
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/92/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 21 Ottobre 2025">
                                21
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/125/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 22 Ottobre 2025">
                                22
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                23
                            </div>
                        
                    
                
                    
                        
                            <a href="/tts/reader/127/" 
                               class="calendar-day has-review today"
                               title="Rassegna disponibile per 24 Ottobre 2025">
                                24
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                25
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                26
                            </div>
                        
                    
                
            
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                27
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                28
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                29
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                30
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                31
                            </div>
                        
                    
                
                    
                        <div class="calendar-day empty"></div>
                    
                
                    
                        <div class="calendar-day empty"></div>
                    
                
            
        </div>
        <div class="calendar-legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #27ae60;"></div>
                <span>Rassegna disponibile</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span>Oggi</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>Rassegna di oggi</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #bdc3c7;"></div>
                <span>Data futura</span>
            </div>
        </div>
    </div>
    
    <div class="review-info">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2>📰 Rassegna del 24 Ottobre 2025</h2>
            <a href="/admin/" class="btn" style="text-decoration: none;">⚙️ Admin</a>
        </div>
        
        <!-- Statistiche principali -->
        <div class="control-group" style="flex-wrap: wrap; margin-bottom: 10px;">
            <span>📊 <strong>8</strong> articoli</span>
            <span>📡 <strong>1</strong> fonti</span>
            <span>📝 <strong>585</strong> parole</span>
            <span>🎧 <strong>2</strong> riproduzioni</span>
        </div>
        
        <!-- Statistiche dettagliate -->
        <div class="control-group" style="flex-wrap: wrap; margin-bottom: 10px;">
            <span>📂 <strong>3</strong> categorie</span>
            <span>🏷️ <strong>29</strong> tag</span>
            <span>🔗 <strong>3</strong> temi unificati</span>
            
            <span>🤖 <strong>Ollama (jobautomation/OpenEuroLLM-Italian:latest)</strong></span>
            
        </div>
        
        <!-- Dettagli aggiuntivi -->
        
        <div class="control-group">
            <span>⏱️ Generazione: <strong>1622518ms</strong></span>
            <span>📅 Creata: <strong>24/10/2025 10:15</strong></span>
        </div>
        
        
        <!-- Sistema di Rating -->
        <div class="rating-section" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ecf0f1;">
            <h4 style="margin-bottom: 10px;">⭐ Valuta questa rassegna</h4>
            <div class="rating-display">
                
                    <div class="current-rating" style="margin-bottom: 10px;">
                        <span style="font-size: 18px; color: #f39c12;">
                            
                            <span style="font-size: 18px; color: #f39c12;">★</span>
                            
                            <span style="font-size: 18px; color: #f39c12;">★</span>
                            
                            <span style="font-size: 18px; color: #f39c12;">★</span>
                            
                            <span style="font-size: 18px; color: #f39c12;">★</span>
                            
                            <span style="font-size: 18px; color: #f39c12;">★</span>
                            
                        </span>
                        <span style="margin-left: 10px; font-weight: bold;">
                            5,0/5 (1 voto)
                        </span>
                    </div>
                
                
                <div class="rating-stars" style="margin-bottom: 10px;">
                    <span style="margin-right: 10px;">Il tuo voto:</span>
                    
                        <span class="star" data-rating="1" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                        <span class="star" data-rating="2" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                        <span class="star" data-rating="3" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                        <span class="star" data-rating="4" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                        <span class="star" data-rating="5" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                </div>
                
                <div id="rating-message" class="status" style="display: none; margin-top: 10px;"></div>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <h3>🎛️ Controlli Audio</h3>
        
        <div class="control-group">
            <label>Voce:</label>
            <select id="voiceSelect" class="voice-selector">
                <option value="">Caricamento voci...</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>Velocità:</label>
            <input type="range" id="rateSlider" min="0.5" max="2" step="0.1" value="1">
            <span id="rateValue">1.0x</span>
        </div>
        
        <div class="control-group">
            <label>Pitch:</label>
            <input type="range" id="pitchSlider" min="0.5" max="2" step="0.1" value="1">
            <span id="pitchValue">1.0</span>
        </div>
        
        <div class="control-group">
            <label>Volume:</label>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.8">
            <span id="volumeValue">0.8</span>
        </div>
        
        <div class="control-group">
            <button id="playPauseBtn" class="btn success" style="width: 100%; font-size: 18px; padding: 15px;">▶️ Inizia Lettura</button>
        </div>
        
        <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
        </div>
        
        <div id="status" class="status info" style="display: none;"></div>
    </div>
    
    <div class="content">
        <h3>📖 Contenuto</h3>
        <div id="reviewContent" lang="it"><p>RASSEGNA STAMPA 24/10/2025</p>

<p>POLITICA.</p>

<p>La situazione nel conflitto israelo-palestinese continua a generare preoccupazione, con la Striscia di Gaza che affronta una grave crisi umanitaria e difficoltà nell&#x27;accesso agli aiuti necessari. Le informazioni relative alla gestione degli ostaggi da parte di Hamas sollevano interrogativi inquietanti, mentre l&#x27;approvazione di una legge israeliana che estende la sovranità su aree della Cisgiordania ha suscitato un&#x27;ondata di critiche a livello internazionale. La Corte internazionale di giustizia ha ribadito l&#x27;urgenza di facilitare l&#x27;accesso delle organizzazioni umanitarie, evidenziando la gravità della situazione.</p>

<p>Parallelamente, le nuove sanzioni statunitensi nei confronti della Russia hanno provocato una risposta veemente da parte del Presidente Putin, che le ha definite un tentativo di pressione con ripercussioni economiche negative per gli Stati Uniti, in particolare un aumento dei prezzi del petrolio. L&#x27;avvertimento di una risposta &quot;sbalorditiva&quot; in caso di aggressione missilistica sul territorio russo sottolinea la tensione crescente tra i due paesi. Nonostante la cancellazione del vertice con Donald Trump, Putin ha espresso la preferenza per il dialogo come alternativa al conflitto.</p>

<p>Un&#x27;indagine ha portato alla luce interrogazioni eccessive e mirate da parte del partito AfD al Parlamento tedesco, riguardanti temi sensibili legati ai trasporti militari e alla sicurezza. Il sospetto che queste informazioni possano finire nelle mani della Russia per alimentare una guerra ibrida riapre il dibattito sui legami tra alcuni esponenti dell&#x27;AfD e potenze straniere, con precedenti casi di spionaggio a favore di Cina e Russia.</p>

<p>All&#x27;interno della maggioranza di governo italiana, la manovra economica sta alimentando forti tensioni, con critiche aperte tra il Ministro degli Esteri Tajani e il leader della Lega Salvini nei confronti del Ministro dell&#x27;Economia Giorgetti. Le divergenze riguardano scelte cruciali come le tasse sugli affitti brevi, i finanziamenti per opere pubbliche e il piano casa, e rischiano di compromettere l&#x27;approvazione della manovra stessa, soprattutto in vista delle prossime elezioni regionali.</p>

<p>CRONACA.</p>

<p>Un tragico evento ha scosso Milano, con l&#x27;uccisione di Luciana Ronchi, una donna di sessantadue anni, per mano del suo ex coniuge, Luigi Morcaldi. La coppia, unita per quasi mezzo secolo e convivente da oltre quarant’anni, aveva interrotto la relazione due anni or sono, in seguito a un periodo di forti tensioni, che sembravano placate dalla ritrovata serenità della vittima. Le immagini delle telecamere di sicurezza hanno immortalato l&#x27;aggressione, durata un minuto e sedici secondi, durante la quale la donna ha tentato invano di reagire. L&#x27;uomo, ora in custodia, dovrà rispondere dell&#x27;accusa di omicidio aggravato, un atto che ha lasciato sgomento nella comunità.</p>

<p>Parallelamente, un episodio di Bologna ha generato forte disappunto, con lo sgombero forzato di una madre sola con tre figli, uno dei quali disabile. L&#x27;intervento delle autorità, ripreso e diffuso, ha sollevato interrogativi sulla priorità sempre maggiore attribuita al turismo rispetto alla necessità di garantire alloggi dignitosi per i residenti. La vicenda evidenzia una crescente preoccupazione per la perdita di sensibilità umana e per la mancanza di soluzioni abitative adeguate per le famiglie in difficoltà. Si tratta di situazioni che, pur nella loro diversità, riflettono un disagio sociale profondo e la necessità di ripensare le politiche di assistenza e di tutela dei più vulnerabili.</p>

<p>SALUTE.<br>La circolazione del virus influenzale è in crescita, con le prime rilevazioni in Lombardia e Lazio. Si segnala un aumento delle sindromi simil-influenzali, soprattutto tra i più giovani. La campagna vaccinale antinfluenzale procede, sebbene con qualche rallentamento nella distribuzione di vaccini complementari. Gli esperti prevedono un&#x27;andamento simile a quello dell&#x27;anno passato, con un picco di contagi atteso tra novembre e dicembre. È dunque auspicabile una maggiore attenzione alla prevenzione e alla vaccinazione.</p></div>
    </div>

    <script>
        class PressReviewReader {
            constructor() {
                this.synth = window.speechSynthesis;
                this.utterance = null;
                this.voices = [];
                this.isReading = false;
                this.hasPlayedOnce = false;
                this.isPaused = false;
                this.currentPosition = 0;
                this.content = `RASSEGNA STAMPA 24/10/2025\u000A\u000APOLITICA.\u000A\u000ALa situazione nel conflitto israelo\u002Dpalestinese continua a generare preoccupazione, con la Striscia di Gaza che affronta una grave crisi umanitaria e difficoltà nell\u0027accesso agli aiuti necessari. Le informazioni relative alla gestione degli ostaggi da parte di Hamas sollevano interrogativi inquietanti, mentre l\u0027approvazione di una legge israeliana che estende la sovranità su aree della Cisgiordania ha suscitato un\u0027ondata di critiche a livello internazionale. La Corte internazionale di giustizia ha ribadito l\u0027urgenza di facilitare l\u0027accesso delle organizzazioni umanitarie, evidenziando la gravità della situazione.\u000A\u000AParallelamente, le nuove sanzioni statunitensi nei confronti della Russia hanno provocato una risposta veemente da parte del Presidente Putin, che le ha definite un tentativo di pressione con ripercussioni economiche negative per gli Stati Uniti, in particolare un aumento dei prezzi del petrolio. L\u0027avvertimento di una risposta \u0022sbalorditiva\u0022 in caso di aggressione missilistica sul territorio russo sottolinea la tensione crescente tra i due paesi. Nonostante la cancellazione del vertice con Donald Trump, Putin ha espresso la preferenza per il dialogo come alternativa al conflitto.\u000A\u000AUn\u0027indagine ha portato alla luce interrogazioni eccessive e mirate da parte del partito AfD al Parlamento tedesco, riguardanti temi sensibili legati ai trasporti militari e alla sicurezza. Il sospetto che queste informazioni possano finire nelle mani della Russia per alimentare una guerra ibrida riapre il dibattito sui legami tra alcuni esponenti dell\u0027AfD e potenze straniere, con precedenti casi di spionaggio a favore di Cina e Russia.\u000A\u000AAll\u0027interno della maggioranza di governo italiana, la manovra economica sta alimentando forti tensioni, con critiche aperte tra il Ministro degli Esteri Tajani e il leader della Lega Salvini nei confronti del Ministro dell\u0027Economia Giorgetti. Le divergenze riguardano scelte cruciali come le tasse sugli affitti brevi, i finanziamenti per opere pubbliche e il piano casa, e rischiano di compromettere l\u0027approvazione della manovra stessa, soprattutto in vista delle prossime elezioni regionali.\u000A\u000ACRONACA.\u000A\u000AUn tragico evento ha scosso Milano, con l\u0027uccisione di Luciana Ronchi, una donna di sessantadue anni, per mano del suo ex coniuge, Luigi Morcaldi. La coppia, unita per quasi mezzo secolo e convivente da oltre quarant’anni, aveva interrotto la relazione due anni or sono, in seguito a un periodo di forti tensioni, che sembravano placate dalla ritrovata serenità della vittima. Le immagini delle telecamere di sicurezza hanno immortalato l\u0027aggressione, durata un minuto e sedici secondi, durante la quale la donna ha tentato invano di reagire. L\u0027uomo, ora in custodia, dovrà rispondere dell\u0027accusa di omicidio aggravato, un atto che ha lasciato sgomento nella comunità.\u000A\u000AParallelamente, un episodio di Bologna ha generato forte disappunto, con lo sgombero forzato di una madre sola con tre figli, uno dei quali disabile. L\u0027intervento delle autorità, ripreso e diffuso, ha sollevato interrogativi sulla priorità sempre maggiore attribuita al turismo rispetto alla necessità di garantire alloggi dignitosi per i residenti. La vicenda evidenzia una crescente preoccupazione per la perdita di sensibilità umana e per la mancanza di soluzioni abitative adeguate per le famiglie in difficoltà. Si tratta di situazioni che, pur nella loro diversità, riflettono un disagio sociale profondo e la necessità di ripensare le politiche di assistenza e di tutela dei più vulnerabili.\u000A\u000ASALUTE.\u000ALa circolazione del virus influenzale è in crescita, con le prime rilevazioni in Lombardia e Lazio. Si segnala un aumento delle sindromi simil\u002Dinfluenzali, soprattutto tra i più giovani. La campagna vaccinale antinfluenzale procede, sebbene con qualche rallentamento nella distribuzione di vaccini complementari. Gli esperti prevedono un\u0027andamento simile a quello dell\u0027anno passato, con un picco di contagi atteso tra novembre e dicembre. È dunque auspicabile una maggiore attenzione alla prevenzione e alla vaccinazione.`;
                
                // Sistema di chunking per testi lunghi
                this.chunks = this.createChunks(this.content);
                this.currentChunkIndex = 0;
                this.totalChunks = this.chunks.length;
                
                this.initializeElements();
                this.loadVoices();
                this.setupEventListeners();
                
                console.log(`📚 Testo diviso in ${this.totalChunks} chunk(s)`);
            }
            
            initializeElements() {
                this.voiceSelect = document.getElementById('voiceSelect');
                this.rateSlider = document.getElementById('rateSlider');
                this.pitchSlider = document.getElementById('pitchSlider');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.rateValue = document.getElementById('rateValue');
                this.pitchValue = document.getElementById('pitchValue');
                this.volumeValue = document.getElementById('volumeValue');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.status = document.getElementById('status');
                this.progressFill = document.getElementById('progressFill');
                this.contentDiv = document.getElementById('reviewContent');
            }
            
            createChunks(text) {
                // Rimuovi spazi extra e normalizza il testo
                text = text.trim().replace(/\s+/g, ' ');
                
                // Prima divisione per paragrafi (linee vuote o doppie newline)
                let paragraphs = text.split(/\n\s*\n/).filter(p => p.trim().length > 0);
                
                const chunks = [];
                const maxChunkLength = 500; // Limite di caratteri per chunk (sicuro per TTS)
                
                paragraphs.forEach(paragraph => {
                    paragraph = paragraph.trim();
                    
                    if (paragraph.length <= maxChunkLength) {
                        // Il paragrafo è già abbastanza piccolo
                        chunks.push(paragraph);
                    } else {
                        // Dividi il paragrafo in frasi
                        const sentences = paragraph.split(/([.!?]+\s+)/).filter(s => s.trim().length > 0);
                        let currentChunk = '';
                        
                        for (let i = 0; i < sentences.length; i += 2) {
                            const sentence = sentences[i] + (sentences[i + 1] || '');
                            
                            if ((currentChunk + sentence).length <= maxChunkLength) {
                                currentChunk += sentence;
                            } else {
                                if (currentChunk.trim()) {
                                    chunks.push(currentChunk.trim());
                                }
                                currentChunk = sentence;
                            }
                        }
                        
                        if (currentChunk.trim()) {
                            chunks.push(currentChunk.trim());
                        }
                    }
                });
                
                // Log per debug
                chunks.forEach((chunk, index) => {
                    console.log(`📄 Chunk ${index + 1}: ${chunk.length} caratteri - "${chunk.substring(0, 50)}..."`);
                });
                
                return chunks.filter(chunk => chunk.trim().length > 0);
            }
            
            loadVoices() {
                this.voices = this.synth.getVoices();
                
                if (this.voices.length == 0) {
                    // Riprova dopo un po' se le voci non sono ancora caricate
                    setTimeout(() => this.loadVoices(), 100);
                    return;
                }
                
                this.populateVoiceSelect();
            }
            
            populateVoiceSelect() {
                this.voiceSelect.innerHTML = '';
                
                // Filtra voci italiane con priorità
                const italianVoices = this.voices.filter(voice => 
                    voice.lang == 'it-IT' || 
                    voice.lang == 'it' ||
                    voice.lang.startsWith('it-') ||
                    voice.name.toLowerCase().includes('italian') ||
                    voice.name.toLowerCase().includes('italiano')
                );
                
                // Ordina le voci italiane per preferenza
                italianVoices.sort((a, b) => {
                    // Priorità per voci specificamente italiane
                    if (a.lang == 'it-IT' && b.lang !== 'it-IT') return -1;
                    if (b.lang == 'it-IT' && a.lang !== 'it-IT') return 1;
                    if (a.lang == 'it' && b.lang !== 'it') return -1;
                    if (b.lang == 'it' && a.lang !== 'it') return 1;
                    return a.name.localeCompare(b.name);
                });
                
                const otherVoices = this.voices.filter(voice => 
                    !italianVoices.includes(voice)
                );
                
                // Aggiungi voci italiane prima
                if (italianVoices.length > 0) {
                    const italianGroup = document.createElement('optgroup');
                    italianGroup.label = `🇮🇹 Voci Italiane (${italianVoices.length})`;
                    
                    italianVoices.forEach((voice, index) => {
                        const option = document.createElement('option');
                        option.value = this.voices.indexOf(voice);
                        option.textContent = `${voice.name} (${voice.lang})`;
                        if (voice.default) option.textContent += ' [Default]';
                        if (voice.localService == false) option.textContent += ' [Cloud]';
                        italianGroup.appendChild(option);
                    });
                    
                    this.voiceSelect.appendChild(italianGroup);
                    this.voiceSelect.value = this.voices.indexOf(italianVoices[0]); // Prima voce italiana
                }
                
                // Aggiungi altre voci
                if (otherVoices.length > 0) {
                    const otherGroup = document.createElement('optgroup');
                    otherGroup.label = `🌍 Altre Voci (${otherVoices.length})`;
                    
                    otherVoices.forEach((voice) => {
                        const option = document.createElement('option');
                        option.value = this.voices.indexOf(voice);
                        option.textContent = `${voice.name} (${voice.lang})`;
                        otherGroup.appendChild(option);
                    });
                    
                    this.voiceSelect.appendChild(otherGroup);
                }
                
                // Messaggio di stato più dettagliato
                if (italianVoices.length > 0) {
                    this.showStatus(`✅ Trovate ${italianVoices.length} voci italiane. Lingua impostata su italiano.`, 'info');
                } else {
                    this.showStatus('⚠️ Nessuna voce italiana trovata. Controlla le impostazioni lingua del sistema.', 'warning');
                }
            }
            
            setupEventListeners() {
                // Slider eventi
                this.rateSlider.addEventListener('input', (e) => {
                    this.rateValue.textContent = parseFloat(e.target.value).toFixed(1) + 'x';
                });
                
                this.pitchSlider.addEventListener('input', (e) => {
                    this.pitchValue.textContent = parseFloat(e.target.value).toFixed(1);
                });
                
                this.volumeSlider.addEventListener('input', (e) => {
                    this.volumeValue.textContent = parseFloat(e.target.value).toFixed(1);
                });
                
                // Pulsanti
                this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
                
                // Caricamento voci quando disponibili
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = () => this.loadVoices();
                }
            }
            
            createUtterance(text) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                utterance.lang = 'it-IT';
                
                if (this.voices.length > 0 && this.voiceSelect.value !== '') {
                    utterance.voice = this.voices[parseInt(this.voiceSelect.value)];
                }
                
                utterance.rate = parseFloat(this.rateSlider.value);
                utterance.pitch = parseFloat(this.pitchSlider.value);
                utterance.volume = parseFloat(this.volumeSlider.value);
                
                return utterance;
            }
            
            togglePlayPause() {
                if (this.isReading) {
                    // Se sta leggendo, metti in pausa o riprendi
                    if (this.synth.speaking && !this.isPaused) {
                        this.synth.pause();
                        this.isPaused = true;
                        this.playPauseBtn.innerHTML = '▶️ Riprendi Lettura';
                        this.showStatus('⏸️ Lettura in pausa', 'warning');
                    } else if (this.isPaused) {
                        this.synth.resume();
                        this.isPaused = false;
                        this.playPauseBtn.innerHTML = '⏸️ Pausa Lettura';
                        this.showStatus('▶️ Lettura ripresa', 'info');
                    }
                } else {
                    // Inizia la lettura dal chunk corrente
                    this.startReading();
                }
            }
            
            startReading() {
                // Stop any previous reading
                this.synth.cancel();
                
                // Verifica che ci siano chunk da leggere
                if (this.currentChunkIndex >= this.totalChunks) {
                    this.showStatus('✅ Lettura completata', 'info');
                    return;
                }
                
                // Incrementa il contatore solo alla prima riproduzione
                if (!this.hasPlayedOnce) {
                    this.incrementPlayCount();
                    this.hasPlayedOnce = true;
                }
                
                this.isReading = true;
                this.isPaused = false;
                this.playPauseBtn.innerHTML = '⏸️ Pausa Lettura';
                
                this.playCurrentChunk();
            }
            
            playCurrentChunk() {
                if (this.currentChunkIndex >= this.totalChunks) {
                    // Tutti i chunk sono stati letti
                    this.isReading = false;
                    this.isPaused = false;
                    this.playPauseBtn.innerHTML = '▶️ Inizia Lettura';
                    this.progressFill.style.width = '100%';
                    this.showStatus('✅ Lettura completata', 'info');
                    this.currentChunkIndex = 0; // Reset per una nuova lettura
                    return;
                }
                
                const currentText = this.chunks[this.currentChunkIndex];
                const utterance = this.createUtterance(currentText);
                
                this.showStatus(`🎤 Lettura chunk ${this.currentChunkIndex + 1}/${this.totalChunks}...`, 'info');
                
                utterance.onend = () => {
                    if (!this.isPaused && this.isReading) {
                        this.currentChunkIndex++;
                        this.updateGlobalProgress();
                        
                        // Breve pausa tra i chunk per evitare problemi
                        setTimeout(() => {
                            if (this.isReading && !this.isPaused) {
                                this.playCurrentChunk();
                            }
                        }, 100);
                    }
                };
                
                utterance.onerror = (event) => {
                    this.isReading = false;
                    this.isPaused = false;
                    this.playPauseBtn.innerHTML = '▶️ Inizia Lettura';
                    this.showStatus('❌ Errore: ' + event.error, 'error');
                };
                
                utterance.onboundary = (event) => {
                    // Progresso all'interno del chunk corrente
                    const chunkProgress = (event.charIndex / currentText.length);
                    const totalProgress = ((this.currentChunkIndex + chunkProgress) / this.totalChunks) * 100;
                    this.progressFill.style.width = totalProgress + '%';
                };
                
                this.utterance = utterance;
                this.synth.speak(utterance);
            }
            
            updateGlobalProgress() {
                const progress = (this.currentChunkIndex / this.totalChunks) * 100;
                this.progressFill.style.width = progress + '%';
            }
            
            incrementPlayCount() {
                const reviewId = 127;
                
                fetch(`/tts/api/reviews/${reviewId}/play/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': this.getCSRFToken(),
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Aggiorna il contatore nell'interfaccia
                        const playCountElement = document.querySelector('.control-group span:nth-child(4)');
                        if (playCountElement) {
                            playCountElement.innerHTML = `🎧 <strong>${data.play_count}</strong> riproduzioni`;
                        }
                    }
                })
                .catch(error => {
                    console.log('Errore incremento play count:', error);
                });
            }
            
            getCSRFToken() {
                // 1. Prova il meta tag (più affidabile per ngrok)
                const metaToken = document.querySelector('meta[name="csrf-token"]');
                if (metaToken) {
                    const token = metaToken.getAttribute('content');
                    if (token) {
                        return token;
                    }
                }
                
                // 2. Prova il token dal DOM input
                const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
                if (csrfInput) {
                    return csrfInput.value;
                }
                
                // 3. Fallback ai cookie
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'csrftoken') {
                        return decodeURIComponent(value);
                    }
                }
                
                // Debug per ngrok
                console.log('CSRF Debug - Meta token:', metaToken ? metaToken.getAttribute('content') : 'NONE');
                console.log('CSRF Debug - Cookies disponibili:', document.cookie);
                console.log('CSRF Debug - Dominio corrente:', window.location.hostname);
                console.log('CSRF Debug - Input CSRF:', csrfInput ? csrfInput.value : 'NONE');
                
                return '';
            }
            
            showStatus(message, type = 'info') {
                this.status.textContent = message;
                this.status.className = `status ${type}`;
                this.status.style.display = 'block';
                
                // Nascondi dopo 5 secondi se è un messaggio di successo
                if (type == 'info') {
                    setTimeout(() => {
                        this.status.style.display = 'none';
                    }, 5000);
                }
            }
        }
        
        // Sistema di Rating
        class RatingSystem {
            constructor() {
                this.reviewId = 127;
                this.stars = document.querySelectorAll('.rating-stars .star');
                this.messageDiv = document.getElementById('rating-message');
                this.currentRating = 0;
                this.hasVoted = false;
                
                this.setupEventListeners();
                this.checkExistingVote();
            }
            
            setupEventListeners() {
                this.stars.forEach((star, index) => {
                    star.addEventListener('mouseover', () => this.highlightStars(index + 1));
                    star.addEventListener('mouseout', () => this.resetHighlight());
                    star.addEventListener('click', () => this.submitRating(index + 1));
                });
            }
            
            highlightStars(rating) {
                if (this.hasVoted) return;
                
                this.stars.forEach((star, index) => {
                    star.textContent = '★';  // Usa sempre lo stesso simbolo
                    if (index < rating) {
                        star.style.color = '#f39c12';
                    } else {
                        star.style.color = '#ddd';
                    }
                });
            }
            
            resetHighlight() {
                if (this.hasVoted) return;
                
                this.stars.forEach((star, index) => {
                    star.textContent = '★';  // Usa sempre lo stesso simbolo
                    if (index < this.currentRating) {
                        star.style.color = '#f39c12';
                    } else {
                        star.style.color = '#ddd';
                    }
                });
            }
            
            submitRating(rating) {
                if (this.hasVoted) {
                    this.showMessage('Hai già votato questa rassegna!', 'warning');
                    return;
                }
                
                this.showMessage('Invio voto...', 'info');
                
                fetch(`/tts/api/reviews/${this.reviewId}/rate/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': this.getCSRFToken(),
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ rating: rating })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        this.hasVoted = true;
                        this.currentRating = rating;
                        this.updateDisplay(rating);
                        this.showMessage(`Grazie! Hai votato ${rating} stelle`, 'info');
                        
                        // Salva nel localStorage per evitare voti multipli
                        const votedKey = `voted_review_${this.reviewId}`;
                        localStorage.setItem(votedKey, rating.toString());
                        
                        // Aggiorna la media se fornita
                        if (data.average_rating !== undefined) {
                            this.updateAverageDisplay(data.average_rating, data.total_votes);
                        }
                    } else {
                        this.showMessage(data.message || 'Errore durante il voto', 'error');
                    }
                })
                .catch(error => {
                    console.error('Errore rating:', error);
                    this.showMessage('Errore di connessione', 'error');
                });
            }
            
            updateDisplay(rating) {
                this.stars.forEach((star, index) => {
                    star.textContent = '★';  // Usa sempre lo stesso simbolo
                    if (index < rating) {
                        star.style.color = '#f39c12';
                    } else {
                        star.style.color = '#ddd';
                    }
                    star.style.cursor = 'default';
                });
            }
            
            updateAverageDisplay(average, totalVotes) {
                const currentRatingDiv = document.querySelector('.current-rating');
                if (currentRatingDiv) {
                    // Aggiorna la media esistente
                    const starsSpan = currentRatingDiv.querySelector('span:first-child');
                    const textSpan = currentRatingDiv.querySelector('span:last-child');
                    
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        const color = i <= Math.round(average) ? '#f39c12' : '#ddd';
                        starsHtml += `<span style="color: ${color};">★</span>`;
                    }
                    
                    starsSpan.innerHTML = starsHtml;
                    textSpan.textContent = `${average}/5 (${totalVotes} vot${totalVotes === 1 ? 'o' : 'i'})`;
                } else {
                    // Crea la sezione media se non esiste
                    const ratingDisplay = document.querySelector('.rating-display');
                    const newRatingDiv = document.createElement('div');
                    newRatingDiv.className = 'current-rating';
                    newRatingDiv.style.marginBottom = '10px';
                    
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        const color = i <= Math.round(average) ? '#f39c12' : '#ddd';
                        starsHtml += `<span style="color: ${color};">★</span>`;
                    }
                    
                    newRatingDiv.innerHTML = `
                        <span style="font-size: 18px;">${starsHtml}</span>
                        <span style="margin-left: 10px; font-weight: bold;">${average}/5 (${totalVotes} vot${totalVotes === 1 ? 'o' : 'i'})</span>
                    `;
                    
                    ratingDisplay.insertBefore(newRatingDiv, ratingDisplay.firstChild);
                }
            }
            
            checkExistingVote() {
                // Controlla se l'utente ha già votato (tramite cookie o localStorage)
                const votedKey = `voted_review_${this.reviewId}`;
                const existingVote = localStorage.getItem(votedKey);
                
                if (existingVote) {
                    this.hasVoted = true;
                    this.currentRating = parseInt(existingVote);
                    this.updateDisplay(this.currentRating);
                    this.showMessage('Hai già votato questa rassegna', 'info');
                }
            }
            
            getCSRFToken() {
                // 1. Prova il meta tag (più affidabile per ngrok)
                const metaToken = document.querySelector('meta[name="csrf-token"]');
                if (metaToken) {
                    const token = metaToken.getAttribute('content');
                    if (token) {
                        return token;
                    }
                }
                
                // 2. Prova il token dal DOM input
                const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
                if (csrfInput) {
                    return csrfInput.value;
                }
                
                // 3. Fallback ai cookie
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'csrftoken') {
                        return decodeURIComponent(value);
                    }
                }
                
                // Debug per ngrok
                console.log('CSRF Debug - Meta token:', metaToken ? metaToken.getAttribute('content') : 'NONE');
                console.log('CSRF Debug - Cookies disponibili:', document.cookie);
                console.log('CSRF Debug - Dominio corrente:', window.location.hostname);
                console.log('CSRF Debug - Input CSRF:', csrfInput ? csrfInput.value : 'NONE');
                
                return '';
            }
            
            showMessage(message, type = 'info') {
                this.messageDiv.textContent = message;
                this.messageDiv.className = `status ${type}`;
                this.messageDiv.style.display = 'block';
                
                // Nascondi dopo 5 secondi
                setTimeout(() => {
                    this.messageDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // Inizializza quando la pagina è caricata
        document.addEventListener('DOMContentLoaded', () => {
            new PressReviewReader();
            new RatingSystem();

                // Nascondi il calendario se il query param generate_static=True
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('generate_static') === 'true') {
                    const calendarBlock = document.querySelector('.calendar');
                    if (calendarBlock) {
                        calendarBlock.classList.add('hide');
                    }
                }
        });
    </script>
</body>
</html>