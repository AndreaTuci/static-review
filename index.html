
<!DOCTYPE html>
<html lang="it">
<head>
    <base href="./">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/ico" href="/static/favicon.ico"/>
    <title>Lettore Rassegna Stampa</title>
    <meta name="csrf-token" content="VHmDl7HO7IHfW0nms0cCloWe3ZasgjdST1YWPbcaeiZ0F0NGoLnOERBoYJ3CMlNK">
    <input type="hidden" name="csrfmiddlewaretoken" value="VHmDl7HO7IHfW0nms0cCloWe3ZasgjdST1YWPbcaeiZ0F0NGoLnOERBoYJ3CMlNK">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .review-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            line-height: 1.6;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .btn.danger {
            background: #e74c3c;
        }
        
        .btn.danger:hover {
            background: #c0392b;
        }
        
        .btn.success {
            background: #27ae60;
        }
        
        .btn.success:hover {
            background: #229954;
        }
        
        .control-group {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-group label {
            min-width: 100px;
            font-weight: bold;
        }
        
        .control-group input[type="range"] {
            flex: 1;
            margin: 0 10px;
        }
        
        .control-group span {
            min-width: 60px;
            text-align: center;
            font-weight: bold;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .status.info {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .voice-selector {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.3s;
        }
        
        .reading-text {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        /* Stili Calendario */
        .calendar {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .calendar-header {
            background: #34495e;
            color: white;
            padding: 15px 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        
        .calendar-day-header {
            background: #ecf0f1;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            color: #7f8c8d;
            border-bottom: 1px solid #bdc3c7;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 1px solid #ecf0f1;
            background: white;
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: #2c3e50;
        }
        
        .calendar-day:hover {
            background: #f8f9fa;
            transform: scale(1.05);
        }
        
        .calendar-day.empty {
            background: #f8f9fa;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            transform: none;
            background: #f8f9fa;
        }
        
        .calendar-day.today {
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.today:hover {
            background: #2980b9;
        }
        
        .calendar-day.has-review {
            background: #27ae60;
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.has-review:hover {
            background: #229954;
        }
        
        .calendar-day.has-review.today {
            background: #e74c3c;
            color: white;
        }
        
        .calendar-day.has-review.today:hover {
            background: #c0392b;
        }
        
        .calendar-day.future {
            color: #bdc3c7;
            background: #f8f9fa;
        }
        
        .calendar-day.future:hover {
            background: #f8f9fa;
            transform: none;
            cursor: default;
        }
        
        .review-indicator {
            position: absolute;
            top: 3px;
            right: 3px;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            border: 1px solid white;
        }
        
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 15px;
            background: #f8f9fa;
            font-size: 12px;
        }
            /* Classe per nascondere il calendario */
            .hide {
                display: none !important;
            }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        /* Stili Rating System */
        .rating-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .rating-stars .star {
            font-size: 24px !important;
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s !important;
            margin: 0 2px;
            transform: none !important;
        }
        
        .rating-stars .star:hover {
            color: #f39c12 !important;
            transform: none !important;
            font-size: 24px !important;
        }
        
        /* Regola più specifica per forzare la dimensione */
        .rating-section .rating-stars .star,
        .rating-section .rating-stars .star:hover,
        .rating-section .rating-stars .star:active,
        .rating-section .rating-stars .star:focus {
            transform: none !important;
            scale: 1 !important;
            font-size: 24px !important;
        }
        
        .rating-stars .star.active {
            color: #f39c12;
        }
        
        .current-rating {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .current-rating .stars {
            margin-right: 10px;
        }
        
        .rating-display {
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="/static/newsroom.png" alt="NewsRooom Logo" style="max-height: 150px; vertical-align: middle;">
        
    </div>
    
    <!-- Calendario -->
    <div class="calendar hide">
        <div class="calendar-header">
            📅 October 2025
        </div>
        <div class="calendar-grid">
            <!-- Intestazioni giorni -->
            <div class="calendar-day-header">LUN</div>
            <div class="calendar-day-header">MAR</div>
            <div class="calendar-day-header">MER</div>
            <div class="calendar-day-header">GIO</div>
            <div class="calendar-day-header">VEN</div>
            <div class="calendar-day-header">SAB</div>
            <div class="calendar-day-header">DOM</div>
            
            <!-- Giorni del mese -->
            
                
                    
                        <div class="calendar-day empty"></div>
                    
                
                    
                        <div class="calendar-day empty"></div>
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                1
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                2
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                3
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                4
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                5
                            </div>
                        
                    
                
            
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                6
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                7
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                8
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                9
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                10
                            </div>
                        
                    
                
                    
                        
                            <a href="/tts/reader/43/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 11 Ottobre 2025">
                                11
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/83/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 12 Ottobre 2025">
                                12
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
            
                
                    
                        
                            <a href="/tts/reader/84/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 13 Ottobre 2025">
                                13
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                14
                            </div>
                        
                    
                
                    
                        
                            <a href="/tts/reader/85/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 15 Ottobre 2025">
                                15
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/86/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 16 Ottobre 2025">
                                16
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/88/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 17 Ottobre 2025">
                                17
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/89/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 18 Ottobre 2025">
                                18
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                19
                            </div>
                        
                    
                
            
                
                    
                        
                            <a href="/tts/reader/90/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 20 Ottobre 2025">
                                20
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/92/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 21 Ottobre 2025">
                                21
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/125/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 22 Ottobre 2025">
                                22
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <div class="calendar-day " 
                                 title="Nessuna rassegna disponibile">
                                23
                            </div>
                        
                    
                
                    
                        
                            <a href="/tts/reader/127/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 24 Ottobre 2025">
                                24
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/130/" 
                               class="calendar-day has-review "
                               title="Rassegna disponibile per 25 Ottobre 2025">
                                25
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
                    
                        
                            <a href="/tts/reader/132/" 
                               class="calendar-day has-review today"
                               title="Rassegna disponibile per 26 Ottobre 2025">
                                26
                                <div class="review-indicator"></div>
                            </a>
                        
                    
                
            
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                27
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                28
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                29
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                30
                            </div>
                        
                    
                
                    
                        
                            <div class="calendar-day future" title="Data futura">
                                31
                            </div>
                        
                    
                
                    
                        <div class="calendar-day empty"></div>
                    
                
                    
                        <div class="calendar-day empty"></div>
                    
                
            
        </div>
        <div class="calendar-legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #27ae60;"></div>
                <span>Rassegna disponibile</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span>Oggi</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>Rassegna di oggi</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #bdc3c7;"></div>
                <span>Data futura</span>
            </div>
        </div>
    </div>
    
    <div class="review-info">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2>📰 Rassegna del 26 Ottobre 2025</h2>
            <div>
                <a href="/admin/" class="btn  hide" style="text-decoration: none;">⚙️ Admin</a>
                
            </div>
        </div>
        
        <!-- Statistiche principali -->
        <div class="control-group" style="flex-wrap: wrap; margin-bottom: 10px;">
            <span>📊 <strong>8</strong> articoli</span>
            <span>📡 <strong>3</strong> fonti</span>
            <span>📝 <strong>549</strong> parole</span>
            <span>🎧 <strong>0</strong> riproduzioni</span>
        </div>
        
        <!-- Statistiche dettagliate -->
        <div class="control-group" style="flex-wrap: wrap; margin-bottom: 10px;">
            <span>📂 <strong>5</strong> categorie</span>
            <span>🏷️ <strong>30</strong> tag</span>
            <span>🔗 <strong>2</strong> temi unificati</span>
            
            <span>🤖 <strong>Ollama (jobautomation/OpenEuroLLM-Italian:latest)</strong></span>
            
        </div>
        
        <!-- Dettagli aggiuntivi -->
        
        <div class="control-group">
            <span>⏱️ Generazione: <strong>1344831ms</strong></span>
            <span>📅 Creata: <strong>26/10/2025 09:34</strong></span>
        </div>
        
        
        <!-- Sistema di Rating -->
        <div class="rating-section  hide" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ecf0f1;">
            <h4 style="margin-bottom: 10px;">⭐ Valuta questa rassegna</h4>
            <div class="rating-display">
                
                
                <div class="rating-stars" style="margin-bottom: 10px;">
                    <span style="margin-right: 10px;">Il tuo voto:</span>
                    
                        <span class="star" data-rating="1" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                        <span class="star" data-rating="2" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                        <span class="star" data-rating="3" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                        <span class="star" data-rating="4" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                        <span class="star" data-rating="5" 
                              style="font-size: 24px; cursor: pointer; color: #ddd; transition: color 0.2s;">★</span>
                    
                </div>
                
                <div id="rating-message" class="status" style="display: none; margin-top: 10px;"></div>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <h3>🎛️ Controlli Audio</h3>
        
        <div class="control-group">
            <label>Voce:</label>
            <select id="voiceSelect" class="voice-selector">
                <option value="">Caricamento voci...</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>Velocità:</label>
            <input type="range" id="rateSlider" min="0.5" max="2" step="0.1" value="1">
            <span id="rateValue">1.0x</span>
        </div>
        
        <div class="control-group">
            <label>Pitch:</label>
            <input type="range" id="pitchSlider" min="0.5" max="2" step="0.1" value="1">
            <span id="pitchValue">1.0</span>
        </div>
        
        <div class="control-group">
            <label>Volume:</label>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.8">
            <span id="volumeValue">0.8</span>
        </div>
        
        <div class="control-group">
            <button id="playPauseBtn" class="btn success" style="width: 100%; font-size: 18px; padding: 15px;">▶️ Inizia Lettura</button>
        </div>
        
        <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
        </div>
        
        <div id="status" class="status info" style="display: none;"></div>
    </div>
    
    <div class="content">
        <h3>📖 Contenuto</h3>
        <div id="reviewContent" lang="it"><p>RASSEGNA STAMPA 26/10/2025</p>

<p>POLITICA.</p>

<p>Il conflitto in Ucraina continua a dominare l&#x27;attenzione internazionale, con l&#x27;imposizione di nuove sanzioni economiche nei confronti della Russia e l&#x27;annuncio del completamento dei test di un missile nucleare avanzato, circostanza che solleva preoccupazioni sulla stabilità geopolitica. Un recente attacco a Kiev ha tragicamente causato vittime civili, evidenziando la gravità della situazione umanitaria. In questo contesto, si rileva un dibattito interno volto a riconsiderare le strategie di supporto militare all&#x27;Ucraina, con proposte di limitazione dell&#x27;invio di armamenti specifici.</p>

<p>Parallelamente, si avverte una riflessione più ampia sulla percezione del rischio e sulla risposta emotiva nei confronti di diverse crisi globali, con un confronto tra la situazione in Ucraina e quella in Palestina. L&#x27;abbondanza di immagini e l&#x27;influenza delle tecnologie digitali sembrano contribuire a distorcere la valutazione del pericolo reale, suggerendo che la compassione, se non accompagnata da una chiara consapevolezza delle minacce, rischia di offuscare la capacità di affrontare le sfide più pressanti.</p>

<p>Sul fronte internazionale, si segnala l&#x27;inizio di un tour asiatico del presidente statunitense, con un focus sulla regione ASEAN e un&#x27;iniziativa di mediazione tra Thailandia e Cambogia. L&#x27;atmosfera appare favorevole alla ripresa dei negoziati commerciali tra Stati Uniti e Cina, in vista di un incontro cruciale con il presidente Xi Jinping.</p>

<p>Infine, un&#x27;iniziativa europea volta a favorire la mobilità giovanile, DiscoverEu, offre ai diciottenni l&#x27;opportunità di esplorare il continente senza costi di trasporto, promuovendo la conoscenza reciproca e l&#x27;integrazione culturale, un segnale positivo in un periodo di incertezze globali.</p>

<p>ECONOMIA.</p>

<p>L&#x27;analisi delle strategie russe per eludere le sanzioni statunitensi rivela un approccio basato su triangolazioni e l&#x27;utilizzo di intermediari. Le esportazioni energetiche continuerebbero a destinare principalmente a Cina e India, nonostante un possibile impatto sui costi e sui dividendi statali. Non si prospetta una crisi economica immediata, data la rilevanza della Russia come fornitore energetico. L&#x27;aumento dei prezzi, legato a timori di carenza, potrebbe verificarsi nel breve termine, ma la situazione generale dovrebbe rimanere sostanzialmente invariata.</p>

<p>ESTERI.</p>

<p>La situazione a Gaza rimane tesa, con Israele pronta a restituire ulteriori salme di ostaggi, mentre si intensificano le pressioni per il rilascio dei corpi di cittadini americani. Hamas, nel frattempo, ha annunciato operazioni di ricerca di corpi e si mostra disponibile a cedere il controllo amministrativo della Striscia, aprendo persino alla prospettiva di elezioni. Un intervento americano sembra paventato qualora le richieste non vengano accolte. Un attacco di Hamas è stato sventato grazie alla collaborazione tra Israele e gli Stati Uniti, come riferito da un esponente americano.</p>

<p>SPORT.<br>Un episodio drammatico ha scosso il Gran Premio della Malesia di Moto3. Durante le prove, un brutto incidente ha coinvolto il giovane spagnolo José Antonio Rueda e il pilota svizzero Noah Dettwiler. L&#x27;impatto, avvenuto a Sepang, ha reso necessario il trasporto d&#x27;urgenza dei due in ospedale tramite elicottero. Fortunatamente, entrambi i piloti erano coscienti al momento del soccorso. La sessione è stata temporaneamente interrotta, ma la competizione è poi proseguita con un ritardo.</p>

<p>SPETTACOLO.</p>

<p>Paola Cortellesi, durante la sua presidenza di giuria alla Festa di Roma, ha espresso grande appagamento per il fermento giovanile e la partecipazione al festival. L&#x27;attrice e regista ha rimarcato il valore imprescindibile del cinema, auspicando un sostegno più consistente per il settore culturale. Un riconoscimento importante per chi lavora nell&#x27;ombra, dietro le quinte, e un invito a valorizzare il patrimonio cinematografico nazionale.</p></div>
    </div>

    <script>
        class PressReviewReader {
            constructor() {
                this.synth = window.speechSynthesis;
                this.utterance = null;
                this.voices = [];
                this.isReading = false;
                this.hasPlayedOnce = false;
                this.isPaused = false;
                this.currentPosition = 0;
                this.content = `RASSEGNA STAMPA 26/10/2025\u000A\u000APOLITICA.\u000A\u000AIl conflitto in Ucraina continua a dominare l\u0027attenzione internazionale, con l\u0027imposizione di nuove sanzioni economiche nei confronti della Russia e l\u0027annuncio del completamento dei test di un missile nucleare avanzato, circostanza che solleva preoccupazioni sulla stabilità geopolitica. Un recente attacco a Kiev ha tragicamente causato vittime civili, evidenziando la gravità della situazione umanitaria. In questo contesto, si rileva un dibattito interno volto a riconsiderare le strategie di supporto militare all\u0027Ucraina, con proposte di limitazione dell\u0027invio di armamenti specifici.\u000A\u000AParallelamente, si avverte una riflessione più ampia sulla percezione del rischio e sulla risposta emotiva nei confronti di diverse crisi globali, con un confronto tra la situazione in Ucraina e quella in Palestina. L\u0027abbondanza di immagini e l\u0027influenza delle tecnologie digitali sembrano contribuire a distorcere la valutazione del pericolo reale, suggerendo che la compassione, se non accompagnata da una chiara consapevolezza delle minacce, rischia di offuscare la capacità di affrontare le sfide più pressanti.\u000A\u000ASul fronte internazionale, si segnala l\u0027inizio di un tour asiatico del presidente statunitense, con un focus sulla regione ASEAN e un\u0027iniziativa di mediazione tra Thailandia e Cambogia. L\u0027atmosfera appare favorevole alla ripresa dei negoziati commerciali tra Stati Uniti e Cina, in vista di un incontro cruciale con il presidente Xi Jinping.\u000A\u000AInfine, un\u0027iniziativa europea volta a favorire la mobilità giovanile, DiscoverEu, offre ai diciottenni l\u0027opportunità di esplorare il continente senza costi di trasporto, promuovendo la conoscenza reciproca e l\u0027integrazione culturale, un segnale positivo in un periodo di incertezze globali.\u000A\u000AECONOMIA.\u000A\u000AL\u0027analisi delle strategie russe per eludere le sanzioni statunitensi rivela un approccio basato su triangolazioni e l\u0027utilizzo di intermediari. Le esportazioni energetiche continuerebbero a destinare principalmente a Cina e India, nonostante un possibile impatto sui costi e sui dividendi statali. Non si prospetta una crisi economica immediata, data la rilevanza della Russia come fornitore energetico. L\u0027aumento dei prezzi, legato a timori di carenza, potrebbe verificarsi nel breve termine, ma la situazione generale dovrebbe rimanere sostanzialmente invariata.\u000A\u000AESTERI.\u000A\u000ALa situazione a Gaza rimane tesa, con Israele pronta a restituire ulteriori salme di ostaggi, mentre si intensificano le pressioni per il rilascio dei corpi di cittadini americani. Hamas, nel frattempo, ha annunciato operazioni di ricerca di corpi e si mostra disponibile a cedere il controllo amministrativo della Striscia, aprendo persino alla prospettiva di elezioni. Un intervento americano sembra paventato qualora le richieste non vengano accolte. Un attacco di Hamas è stato sventato grazie alla collaborazione tra Israele e gli Stati Uniti, come riferito da un esponente americano.\u000A\u000ASPORT.\u000AUn episodio drammatico ha scosso il Gran Premio della Malesia di Moto3. Durante le prove, un brutto incidente ha coinvolto il giovane spagnolo José Antonio Rueda e il pilota svizzero Noah Dettwiler. L\u0027impatto, avvenuto a Sepang, ha reso necessario il trasporto d\u0027urgenza dei due in ospedale tramite elicottero. Fortunatamente, entrambi i piloti erano coscienti al momento del soccorso. La sessione è stata temporaneamente interrotta, ma la competizione è poi proseguita con un ritardo.\u000A\u000ASPETTACOLO.\u000A\u000APaola Cortellesi, durante la sua presidenza di giuria alla Festa di Roma, ha espresso grande appagamento per il fermento giovanile e la partecipazione al festival. L\u0027attrice e regista ha rimarcato il valore imprescindibile del cinema, auspicando un sostegno più consistente per il settore culturale. Un riconoscimento importante per chi lavora nell\u0027ombra, dietro le quinte, e un invito a valorizzare il patrimonio cinematografico nazionale.`;
                
                // Sistema di chunking per testi lunghi
                this.chunks = this.createChunks(this.content);
                this.currentChunkIndex = 0;
                this.totalChunks = this.chunks.length;
                
                this.initializeElements();
                this.loadVoices();
                this.setupEventListeners();
                
                console.log(`📚 Testo diviso in ${this.totalChunks} chunk(s)`);
            }
            
            initializeElements() {
                this.voiceSelect = document.getElementById('voiceSelect');
                this.rateSlider = document.getElementById('rateSlider');
                this.pitchSlider = document.getElementById('pitchSlider');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.rateValue = document.getElementById('rateValue');
                this.pitchValue = document.getElementById('pitchValue');
                this.volumeValue = document.getElementById('volumeValue');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.status = document.getElementById('status');
                this.progressFill = document.getElementById('progressFill');
                this.contentDiv = document.getElementById('reviewContent');
            }
            
            createChunks(text) {
                // Rimuovi spazi extra e normalizza il testo
                text = text.trim().replace(/\s+/g, ' ');
                
                // Prima divisione per paragrafi (linee vuote o doppie newline)
                let paragraphs = text.split(/\n\s*\n/).filter(p => p.trim().length > 0);
                
                const chunks = [];
                const maxChunkLength = 500; // Limite di caratteri per chunk (sicuro per TTS)
                
                paragraphs.forEach(paragraph => {
                    paragraph = paragraph.trim();
                    
                    if (paragraph.length <= maxChunkLength) {
                        // Il paragrafo è già abbastanza piccolo
                        chunks.push(paragraph);
                    } else {
                        // Dividi il paragrafo in frasi
                        const sentences = paragraph.split(/([.!?]+\s+)/).filter(s => s.trim().length > 0);
                        let currentChunk = '';
                        
                        for (let i = 0; i < sentences.length; i += 2) {
                            const sentence = sentences[i] + (sentences[i + 1] || '');
                            
                            if ((currentChunk + sentence).length <= maxChunkLength) {
                                currentChunk += sentence;
                            } else {
                                if (currentChunk.trim()) {
                                    chunks.push(currentChunk.trim());
                                }
                                currentChunk = sentence;
                            }
                        }
                        
                        if (currentChunk.trim()) {
                            chunks.push(currentChunk.trim());
                        }
                    }
                });
                
                // Log per debug
                chunks.forEach((chunk, index) => {
                    console.log(`📄 Chunk ${index + 1}: ${chunk.length} caratteri - "${chunk.substring(0, 50)}..."`);
                });
                
                return chunks.filter(chunk => chunk.trim().length > 0);
            }
            
            loadVoices() {
                this.voices = this.synth.getVoices();
                
                if (this.voices.length == 0) {
                    // Riprova dopo un po' se le voci non sono ancora caricate
                    setTimeout(() => this.loadVoices(), 100);
                    return;
                }
                
                this.populateVoiceSelect();
            }
            
            populateVoiceSelect() {
                this.voiceSelect.innerHTML = '';
                
                // Filtra voci italiane con priorità
                const italianVoices = this.voices.filter(voice => 
                    voice.lang == 'it-IT' || 
                    voice.lang == 'it' ||
                    voice.lang.startsWith('it-') ||
                    voice.name.toLowerCase().includes('italian') ||
                    voice.name.toLowerCase().includes('italiano')
                );
                
                // Ordina le voci italiane per preferenza
                italianVoices.sort((a, b) => {
                    // Priorità per voci specificamente italiane
                    if (a.lang == 'it-IT' && b.lang !== 'it-IT') return -1;
                    if (b.lang == 'it-IT' && a.lang !== 'it-IT') return 1;
                    if (a.lang == 'it' && b.lang !== 'it') return -1;
                    if (b.lang == 'it' && a.lang !== 'it') return 1;
                    return a.name.localeCompare(b.name);
                });
                
                const otherVoices = this.voices.filter(voice => 
                    !italianVoices.includes(voice)
                );
                
                // Aggiungi voci italiane prima
                if (italianVoices.length > 0) {
                    const italianGroup = document.createElement('optgroup');
                    italianGroup.label = `🇮🇹 Voci Italiane (${italianVoices.length})`;
                    
                    italianVoices.forEach((voice, index) => {
                        const option = document.createElement('option');
                        option.value = this.voices.indexOf(voice);
                        option.textContent = `${voice.name} (${voice.lang})`;
                        if (voice.default) option.textContent += ' [Default]';
                        if (voice.localService == false) option.textContent += ' [Cloud]';
                        italianGroup.appendChild(option);
                    });
                    
                    this.voiceSelect.appendChild(italianGroup);
                    this.voiceSelect.value = this.voices.indexOf(italianVoices[0]); // Prima voce italiana
                }
                
                // Aggiungi altre voci
                if (otherVoices.length > 0) {
                    const otherGroup = document.createElement('optgroup');
                    otherGroup.label = `🌍 Altre Voci (${otherVoices.length})`;
                    
                    otherVoices.forEach((voice) => {
                        const option = document.createElement('option');
                        option.value = this.voices.indexOf(voice);
                        option.textContent = `${voice.name} (${voice.lang})`;
                        otherGroup.appendChild(option);
                    });
                    
                    this.voiceSelect.appendChild(otherGroup);
                }
                
                // Messaggio di stato più dettagliato
                if (italianVoices.length > 0) {
                    this.showStatus(`✅ Trovate ${italianVoices.length} voci italiane. Lingua impostata su italiano.`, 'info');
                } else {
                    this.showStatus('⚠️ Nessuna voce italiana trovata. Controlla le impostazioni lingua del sistema.', 'warning');
                }
            }
            
            setupEventListeners() {
                // Slider eventi
                this.rateSlider.addEventListener('input', (e) => {
                    this.rateValue.textContent = parseFloat(e.target.value).toFixed(1) + 'x';
                });
                
                this.pitchSlider.addEventListener('input', (e) => {
                    this.pitchValue.textContent = parseFloat(e.target.value).toFixed(1);
                });
                
                this.volumeSlider.addEventListener('input', (e) => {
                    this.volumeValue.textContent = parseFloat(e.target.value).toFixed(1);
                });
                
                // Pulsanti
                this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
                
                // Caricamento voci quando disponibili
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = () => this.loadVoices();
                }
            }
            
            createUtterance(text) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                utterance.lang = 'it-IT';
                
                if (this.voices.length > 0 && this.voiceSelect.value !== '') {
                    utterance.voice = this.voices[parseInt(this.voiceSelect.value)];
                }
                
                utterance.rate = parseFloat(this.rateSlider.value);
                utterance.pitch = parseFloat(this.pitchSlider.value);
                utterance.volume = parseFloat(this.volumeSlider.value);
                
                return utterance;
            }
            
            togglePlayPause() {
                if (this.isReading) {
                    // Se sta leggendo, metti in pausa o riprendi
                    if (this.synth.speaking && !this.isPaused) {
                        this.synth.pause();
                        this.isPaused = true;
                        this.playPauseBtn.innerHTML = '▶️ Riprendi Lettura';
                        this.showStatus('⏸️ Lettura in pausa', 'warning');
                    } else if (this.isPaused) {
                        this.synth.resume();
                        this.isPaused = false;
                        this.playPauseBtn.innerHTML = '⏸️ Pausa Lettura';
                        this.showStatus('▶️ Lettura ripresa', 'info');
                    }
                } else {
                    // Inizia la lettura dal chunk corrente
                    this.startReading();
                }
            }
            
            startReading() {
                // Stop any previous reading
                this.synth.cancel();
                
                // Verifica che ci siano chunk da leggere
                if (this.currentChunkIndex >= this.totalChunks) {
                    this.showStatus('✅ Lettura completata', 'info');
                    return;
                }
                
                // Incrementa il contatore solo alla prima riproduzione
                if (!this.hasPlayedOnce) {
                    this.incrementPlayCount();
                    this.hasPlayedOnce = true;
                }
                
                this.isReading = true;
                this.isPaused = false;
                this.playPauseBtn.innerHTML = '⏸️ Pausa Lettura';
                
                this.playCurrentChunk();
            }
            
            playCurrentChunk() {
                if (this.currentChunkIndex >= this.totalChunks) {
                    // Tutti i chunk sono stati letti
                    this.isReading = false;
                    this.isPaused = false;
                    this.playPauseBtn.innerHTML = '▶️ Inizia Lettura';
                    this.progressFill.style.width = '100%';
                    this.showStatus('✅ Lettura completata', 'info');
                    this.currentChunkIndex = 0; // Reset per una nuova lettura
                    return;
                }
                
                const currentText = this.chunks[this.currentChunkIndex];
                const utterance = this.createUtterance(currentText);
                
                this.showStatus(`🎤 Lettura chunk ${this.currentChunkIndex + 1}/${this.totalChunks}...`, 'info');
                
                utterance.onend = () => {
                    if (!this.isPaused && this.isReading) {
                        this.currentChunkIndex++;
                        this.updateGlobalProgress();
                        
                        // Breve pausa tra i chunk per evitare problemi
                        setTimeout(() => {
                            if (this.isReading && !this.isPaused) {
                                this.playCurrentChunk();
                            }
                        }, 100);
                    }
                };
                
                utterance.onerror = (event) => {
                    this.isReading = false;
                    this.isPaused = false;
                    this.playPauseBtn.innerHTML = '▶️ Inizia Lettura';
                    this.showStatus('❌ Errore: ' + event.error, 'error');
                };
                
                utterance.onboundary = (event) => {
                    // Progresso all'interno del chunk corrente
                    const chunkProgress = (event.charIndex / currentText.length);
                    const totalProgress = ((this.currentChunkIndex + chunkProgress) / this.totalChunks) * 100;
                    this.progressFill.style.width = totalProgress + '%';
                };
                
                this.utterance = utterance;
                this.synth.speak(utterance);
            }
            
            updateGlobalProgress() {
                const progress = (this.currentChunkIndex / this.totalChunks) * 100;
                this.progressFill.style.width = progress + '%';
            }
            
            incrementPlayCount() {
                const reviewId = 132;
                
                fetch(`/tts/api/reviews/${reviewId}/play/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': this.getCSRFToken(),
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Aggiorna il contatore nell'interfaccia
                        const playCountElement = document.querySelector('.control-group span:nth-child(4)');
                        if (playCountElement) {
                            playCountElement.innerHTML = `🎧 <strong>${data.play_count}</strong> riproduzioni`;
                        }
                    }
                })
                .catch(error => {
                    console.log('Errore incremento play count:', error);
                });
            }
            
            getCSRFToken() {
                // 1. Prova il meta tag (più affidabile per ngrok)
                const metaToken = document.querySelector('meta[name="csrf-token"]');
                if (metaToken) {
                    const token = metaToken.getAttribute('content');
                    if (token) {
                        return token;
                    }
                }
                
                // 2. Prova il token dal DOM input
                const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
                if (csrfInput) {
                    return csrfInput.value;
                }
                
                // 3. Fallback ai cookie
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'csrftoken') {
                        return decodeURIComponent(value);
                    }
                }
                
                // Debug per ngrok
                console.log('CSRF Debug - Meta token:', metaToken ? metaToken.getAttribute('content') : 'NONE');
                console.log('CSRF Debug - Cookies disponibili:', document.cookie);
                console.log('CSRF Debug - Dominio corrente:', window.location.hostname);
                console.log('CSRF Debug - Input CSRF:', csrfInput ? csrfInput.value : 'NONE');
                
                return '';
            }
            
            showStatus(message, type = 'info') {
                this.status.textContent = message;
                this.status.className = `status ${type}`;
                this.status.style.display = 'block';
                
                // Nascondi dopo 5 secondi se è un messaggio di successo
                if (type == 'info') {
                    setTimeout(() => {
                        this.status.style.display = 'none';
                    }, 5000);
                }
            }
        }
        
        // Sistema di Rating
        class RatingSystem {
            constructor() {
                this.reviewId = 132;
                this.stars = document.querySelectorAll('.rating-stars .star');
                this.messageDiv = document.getElementById('rating-message');
                this.currentRating = 0;
                this.hasVoted = false;
                
                this.setupEventListeners();
                this.checkExistingVote();
            }
            
            setupEventListeners() {
                this.stars.forEach((star, index) => {
                    star.addEventListener('mouseover', () => this.highlightStars(index + 1));
                    star.addEventListener('mouseout', () => this.resetHighlight());
                    star.addEventListener('click', () => this.submitRating(index + 1));
                });
            }
            
            highlightStars(rating) {
                if (this.hasVoted) return;
                
                this.stars.forEach((star, index) => {
                    star.textContent = '★';  // Usa sempre lo stesso simbolo
                    if (index < rating) {
                        star.style.color = '#f39c12';
                    } else {
                        star.style.color = '#ddd';
                    }
                });
            }
            
            resetHighlight() {
                if (this.hasVoted) return;
                
                this.stars.forEach((star, index) => {
                    star.textContent = '★';  // Usa sempre lo stesso simbolo
                    if (index < this.currentRating) {
                        star.style.color = '#f39c12';
                    } else {
                        star.style.color = '#ddd';
                    }
                });
            }
            
            submitRating(rating) {
                if (this.hasVoted) {
                    this.showMessage('Hai già votato questa rassegna!', 'warning');
                    return;
                }
                
                this.showMessage('Invio voto...', 'info');
                
                fetch(`/tts/api/reviews/${this.reviewId}/rate/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': this.getCSRFToken(),
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ rating: rating })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        this.hasVoted = true;
                        this.currentRating = rating;
                        this.updateDisplay(rating);
                        this.showMessage(`Grazie! Hai votato ${rating} stelle`, 'info');
                        
                        // Salva nel localStorage per evitare voti multipli
                        const votedKey = `voted_review_${this.reviewId}`;
                        localStorage.setItem(votedKey, rating.toString());
                        
                        // Aggiorna la media se fornita
                        if (data.average_rating !== undefined) {
                            this.updateAverageDisplay(data.average_rating, data.total_votes);
                        }
                    } else {
                        this.showMessage(data.message || 'Errore durante il voto', 'error');
                    }
                })
                .catch(error => {
                    console.error('Errore rating:', error);
                    this.showMessage('Errore di connessione', 'error');
                });
            }
            
            updateDisplay(rating) {
                this.stars.forEach((star, index) => {
                    star.textContent = '★';  // Usa sempre lo stesso simbolo
                    if (index < rating) {
                        star.style.color = '#f39c12';
                    } else {
                        star.style.color = '#ddd';
                    }
                    star.style.cursor = 'default';
                });
            }
            
            updateAverageDisplay(average, totalVotes) {
                const currentRatingDiv = document.querySelector('.current-rating');
                if (currentRatingDiv) {
                    // Aggiorna la media esistente
                    const starsSpan = currentRatingDiv.querySelector('span:first-child');
                    const textSpan = currentRatingDiv.querySelector('span:last-child');
                    
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        const color = i <= Math.round(average) ? '#f39c12' : '#ddd';
                        starsHtml += `<span style="color: ${color};">★</span>`;
                    }
                    
                    starsSpan.innerHTML = starsHtml;
                    textSpan.textContent = `${average}/5 (${totalVotes} vot${totalVotes === 1 ? 'o' : 'i'})`;
                } else {
                    // Crea la sezione media se non esiste
                    const ratingDisplay = document.querySelector('.rating-display');
                    const newRatingDiv = document.createElement('div');
                    newRatingDiv.className = 'current-rating';
                    newRatingDiv.style.marginBottom = '10px';
                    
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        const color = i <= Math.round(average) ? '#f39c12' : '#ddd';
                        starsHtml += `<span style="color: ${color};">★</span>`;
                    }
                    
                    newRatingDiv.innerHTML = `
                        <span style="font-size: 18px;">${starsHtml}</span>
                        <span style="margin-left: 10px; font-weight: bold;">${average}/5 (${totalVotes} vot${totalVotes === 1 ? 'o' : 'i'})</span>
                    `;
                    
                    ratingDisplay.insertBefore(newRatingDiv, ratingDisplay.firstChild);
                }
            }
            
            checkExistingVote() {
                // Controlla se l'utente ha già votato (tramite cookie o localStorage)
                const votedKey = `voted_review_${this.reviewId}`;
                const existingVote = localStorage.getItem(votedKey);
                
                if (existingVote) {
                    this.hasVoted = true;
                    this.currentRating = parseInt(existingVote);
                    this.updateDisplay(this.currentRating);
                    this.showMessage('Hai già votato questa rassegna', 'info');
                }
            }
            
            getCSRFToken() {
                // 1. Prova il meta tag (più affidabile per ngrok)
                const metaToken = document.querySelector('meta[name="csrf-token"]');
                if (metaToken) {
                    const token = metaToken.getAttribute('content');
                    if (token) {
                        return token;
                    }
                }
                
                // 2. Prova il token dal DOM input
                const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
                if (csrfInput) {
                    return csrfInput.value;
                }
                
                // 3. Fallback ai cookie
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'csrftoken') {
                        return decodeURIComponent(value);
                    }
                }
                
                // Debug per ngrok
                console.log('CSRF Debug - Meta token:', metaToken ? metaToken.getAttribute('content') : 'NONE');
                console.log('CSRF Debug - Cookies disponibili:', document.cookie);
                console.log('CSRF Debug - Dominio corrente:', window.location.hostname);
                console.log('CSRF Debug - Input CSRF:', csrfInput ? csrfInput.value : 'NONE');
                
                return '';
            }
            
            showMessage(message, type = 'info') {
                this.messageDiv.textContent = message;
                this.messageDiv.className = `status ${type}`;
                this.messageDiv.style.display = 'block';
                
                // Nascondi dopo 5 secondi
                setTimeout(() => {
                    this.messageDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // Inizializza quando la pagina è caricata
        document.addEventListener('DOMContentLoaded', () => {
            new PressReviewReader();
            new RatingSystem();

            // Pulsante per generazione statica (solo superadmin)
            const generateBtn = document.getElementById('generateStaticBtn');
            if (generateBtn) {
                generateBtn.addEventListener('click', function() {
                    generateBtn.disabled = true;
                    generateBtn.textContent = '⏳ Generazione..';
                    fetch('/tts/api/generate_static/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                            'Content-Type': 'application/json',
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            generateBtn.textContent = '✅ Statico generato';
                            generateBtn.classList.remove('danger');
                            generateBtn.classList.add('success');
                        } else {
                            generateBtn.textContent = '❌ Errore';
                            generateBtn.disabled = false;
                            alert(data.error || 'Errore generazione statico');
                        }
                    })
                    .catch(err => {
                        generateBtn.textContent = '❌ Errore';
                        generateBtn.disabled = false;
                        alert('Errore generazione statico');
                    });
                });
            }
        });
    </script>
</body>
</html>